/* =============================================================================
  Test SDCC WYZplayer Lib
  Version: 1.4 (11/6/2021)
  Author: mvac7 <mvac7303b@gmail.com>
  Architecture: MSX
  Format: C Object (SDCC .rel)
  Programming language: C
   
  Description:
  Test the different functionalities of the SDCC adaptation of the WYZ player.
    
  History of versions:
  - 1.4 (11/6/2021) Changes in the AY definitions and added SC1 Tileset
  - 1.3 (15/2/2021) Adaptation to WYZ_Player v1.2 (function names)
  - 1.2 (18/1/2021) adapted to v1.1 from SDCC WYZ Player
  - 1.1 (9/7/2019)
  - 1.0 (28/5/2019)
============================================================================= */

#include "../include/newTypes.h"
#include "../include/msxSystemVariables.h"
#include "../include/msxBIOS.h"

#include "../include/interrupt.h"
#include "../include/textmode.h"
#include "../include/keyboard.h"

#include "../include/WYZplayer.h"
#include "../include/WYZsongdata.h"

#include "../include/unRLEWBtoVRAM.h"



#define  HALT __asm halt __endasm   //wait for the next interrupt


#define BASE13 0x1B00 // base 13 sprite attribute table
#define BASE14 0x3800 // base 14 sprite pattern table

#define VDPVRAM   0x98 //VRAM Data (Read/Write)
#define VDPSTATUS 0x99 //VDP Status Registers

 
// VRAM address tables screen 1 TXT32
#define BASE5 0x1800 // base 5 name table
#define BASE6 0x2000 // base 6 color table
#define BASE7 0x0000 // base 7 character pattern table
#define BASE8 0x1B00 // base 8 sprite attribute table
#define BASE9 0x3800 // base 9 sprite pattern table 





// Project: mvac7_tileset_GUI_05
// tileset pattern
// Tiles range: 0 to 255
// RLE WB compressed - Original size= 2048 - Compress size= 1036
const char SC1_TSET[]={
0x80,0x08,0x00,0x70,0x7E,0x80,0x02,0x42,0x7E,0x00,0x78,0x4C,0x4E,0x80,0x02,0x42,
0x7E,0x00,0x80,0x02,0x7F,0x41,0x80,0x02,0x7F,0x00,0x7F,0x77,0x77,0x41,0x77,0x77,
0x7F,0x00,0x80,0x02,0x7F,0x41,0x63,0x77,0x7F,0x7F,0x5C,0x62,0x70,0x5E,0x42,0x42,
0x7E,0x00,0xFC,0xBA,0xBA,0x80,0x02,0x82,0xFE,0x80,0x02,0x00,0x18,0x3C,0x7E,0x80,
0x05,0x00,0x7E,0x3C,0x18,0x80,0x02,0x00,0x08,0x18,0x38,0x38,0x18,0x08,0x00,0x00,
0x10,0x18,0x1C,0x1C,0x18,0x10,0x80,0x20,0x00,0x80,0x02,0x18,0x7E,0x80,0x06,0x18,
0xFF,0xFF,0x80,0x05,0x00,0xFF,0xFF,0x80,0x05,0x18,0xF8,0xF8,0x80,0x05,0x18,0x1F,
0x1F,0x80,0x05,0x18,0xFF,0xFF,0x80,0x0A,0x18,0x80,0x02,0x00,0xFF,0xFF,0x80,0x05,
0x00,0x0F,0x1F,0x1C,0x18,0x18,0x80,0x02,0x00,0xF0,0xF8,0x38,0x80,0x03,0x18,0x1C,
0x1F,0x0F,0x80,0x02,0x00,0x18,0x18,0x38,0xF8,0xF0,0x80,0x02,0x00,0xFF,0xDD,0xEB,
0xF7,0xEB,0xDD,0xFF,0xFF,0x80,0x10,0x00,0x10,0x10,0xFF,0xFF,0x10,0x10,0x80,0x08,
0x00,0x80,0x03,0x30,0x00,0x30,0x30,0x00,0x28,0x28,0x80,0x07,0x00,0x28,0x7C,0x28,
0x7C,0x28,0x00,0x00,0x10,0x7C,0xD0,0x7C,0x16,0x7C,0x10,0x00,0x00,0x66,0x6C,0x18,
0x36,0x66,0x00,0x00,0x70,0xD8,0x7A,0xCC,0xCC,0x7A,0x00,0x00,0x18,0x30,0x80,0x04,
0x00,0x18,0x30,0x80,0x02,0x60,0x30,0x18,0x00,0x60,0x30,0x80,0x02,0x18,0x30,0x60,
0x80,0x02,0x00,0x5A,0x3C,0x7E,0x3C,0x5A,0x80,0x02,0x00,0x18,0x18,0x7E,0x18,0x18,
0x80,0x05,0x00,0x30,0x30,0x20,0x80,0x03,0x00,0x7C,0x80,0x07,0x00,0x30,0x30,0x00,
0x00,0x06,0x0C,0x18,0x30,0x60,0xC0,0x00,0x7C,0xC6,0xCE,0xD6,0xE6,0xC6,0x7C,0x00,
0x30,0x70,0x80,0x03,0x30,0x78,0x00,0xFC,0x06,0x06,0x7C,0xC0,0xC0,0xFE,0x00,0xFC,
0x06,0x06,0x7C,0x06,0x06,0xFC,0x00,0x80,0x02,0xC6,0xFE,0x80,0x02,0x06,0x00,0xFE,
0xC0,0xC0,0xFC,0x06,0x06,0xFC,0x00,0x7C,0xC0,0xC0,0xFC,0xC6,0xC6,0x7C,0x00,0xFE,
0x06,0x0C,0x18,0x80,0x02,0x30,0x00,0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00,0x7C,
0xC6,0xC6,0x7E,0x06,0x06,0x7C,0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x80,0x02,0x00,
0x30,0x30,0x00,0x30,0x30,0x20,0x00,0x00,0x18,0x30,0x60,0x30,0x18,0x80,0x03,0x00,
0x78,0x00,0x78,0x80,0x03,0x00,0x60,0x30,0x18,0x30,0x60,0x00,0x00,0x3C,0x66,0x06,
0x0C,0x18,0x00,0x18,0x00,0x7C,0x82,0xBA,0xAA,0xBE,0x80,0x00,0x7C,0x00,0x7C,0x80,
0x02,0xC6,0xFE,0xC6,0xC6,0x00,0xFC,0xC6,0xC6,0xFC,0xC6,0xC6,0xFC,0x00,0x7E,0x80,
0x04,0xC0,0x7E,0x00,0xFC,0x80,0x04,0xC6,0xFC,0x00,0xFE,0xC0,0xC0,0xF8,0xC0,0xC0,
0xFE,0x00,0xFE,0xC0,0xC0,0xFC,0x80,0x02,0xC0,0x00,0x7E,0xC0,0xC0,0xCE,0xC6,0xC6,
0x7E,0x00,0x80,0x02,0xC6,0xFE,0x80,0x02,0xC6,0x00,0x78,0x80,0x04,0x30,0x78,0x00,
0x3C,0x80,0x03,0x18,0xD8,0x70,0x00,0xC6,0xC6,0xCC,0xF8,0xCC,0xC6,0xC6,0x00,0x80,
0x05,0xC0,0xFE,0x00,0xC6,0xEE,0xFE,0xD6,0x80,0x02,0xC6,0x00,0xC6,0xE6,0xF6,0xDE,
0xCE,0xC6,0xC6,0x00,0x7C,0x80,0x04,0xC6,0x7C,0x00,0xFC,0x80,0x02,0xC6,0xFC,0xC0,
0xC0,0x00,0x7C,0x80,0x02,0xC6,0xD6,0xCC,0x7A,0x00,0xFC,0xC6,0xC6,0xFC,0x80,0x02,
0xC6,0x00,0x7E,0xC0,0xC0,0x7C,0x06,0x06,0xFC,0x00,0xFC,0x80,0x05,0x30,0x00,0x80,
0x05,0xC6,0x7C,0x00,0x80,0x04,0xC6,0x6C,0x38,0x00,0x80,0x02,0xC6,0xD6,0xFE,0xEE,
0xC6,0x00,0xC6,0xC6,0x6C,0x38,0x6C,0xC6,0xC6,0x00,0x80,0x02,0xCC,0x78,0x80,0x02,
0x30,0x00,0xFE,0x06,0x0C,0x18,0x30,0x60,0xFE,0x00,0x0E,0x80,0x04,0x0C,0x0E,0x00,
0x00,0xC0,0x60,0x30,0x18,0x0C,0x06,0x00,0x38,0x80,0x04,0x18,0x38,0x80,0x0E,0x00,
0x7E,0x80,0x0A,0x00,0xFC,0x06,0x7E,0xC6,0xFE,0x00,0xC0,0xC0,0xFC,0x80,0x02,0xC6,
0xFC,0x80,0x02,0x00,0x7E,0x80,0x02,0xC0,0x7E,0x00,0x06,0x06,0x7E,0x80,0x02,0xC6,
0x7E,0x80,0x02,0x00,0x7C,0xC6,0xFE,0xC0,0x7C,0x00,0x3C,0x60,0x60,0xF8,0x80,0x02,
0x60,0x80,0x02,0x00,0x7E,0xC6,0xC6,0x7E,0x06,0x7C,0xC0,0xC0,0xFC,0x80,0x03,0xC6,
0x00,0x30,0x00,0x70,0x80,0x02,0x30,0x78,0x00,0x18,0x00,0x80,0x04,0x18,0x70,0xC0,
0xC0,0xC6,0xCC,0xF8,0xCC,0xC6,0x00,0x70,0x80,0x04,0x30,0x78,0x80,0x02,0x00,0xFC,
0x80,0x03,0xD6,0x80,0x02,0x00,0xDC,0xE6,0x80,0x02,0xC6,0x80,0x02,0x00,0x7C,0x80,
0x02,0xC6,0x7C,0x80,0x02,0x00,0xFC,0x80,0x02,0xC6,0xFC,0xC0,0x00,0x00,0x7E,0x80,
0x02,0xC6,0x7E,0x06,0x00,0x00,0xDC,0xE6,0x80,0x02,0xC0,0x80,0x02,0x00,0x7E,0xC0,
0x7C,0x06,0xFC,0x00,0x30,0x30,0x7C,0x80,0x02,0x30,0x1C,0x80,0x02,0x00,0x80,0x03,
0xC6,0x7C,0x80,0x02,0x00,0x80,0x02,0xC6,0x6C,0x38,0x80,0x02,0x00,0xC6,0xD6,0xFE,
0xEE,0xC6,0x80,0x02,0x00,0xC6,0x6C,0x38,0x6C,0xC6,0x80,0x02,0x00,0x80,0x02,0xC6,
0x7E,0x06,0x7C,0x00,0x00,0xFC,0x18,0x30,0x60,0xFC,0x80,0x29,0x00,0x7C,0x80,0x02,
0xC0,0x7C,0x10,0x30,0x00,0x28,0x00,0x80,0x02,0xC6,0x7C,0x00,0x00,0x06,0x7C,0xC6,
0xFE,0xC0,0x7E,0x80,0x11,0x00,0xC0,0x7C,0x06,0x7E,0xC6,0xFE,0x80,0x0A,0x00,0x7C,
0xC0,0xC0,0x7C,0x10,0x30,0x80,0x10,0x00,0xC0,0x7C,0xC6,0xFE,0xC0,0x7E,0x80,0x11,
0x00,0x30,0x18,0x00,0x38,0x18,0x3C,0x80,0x39,0x00,0xC0,0x60,0x7C,0xC6,0xC6,0x7C,
0x80,0x48,0x00,0x0C,0x1E,0x3E,0x5C,0x68,0x70,0x80,0x02,0x00,0x06,0x7C,0x06,0x7E,
0xC6,0xFE,0x00,0x00,0x0C,0x18,0x00,0x38,0x18,0x3C,0x00,0x00,0x06,0x0C,0x7C,0xC6,
0xC6,0x7C,0x00,0x00,0x06,0x0C,0x80,0x02,0xC6,0x7C,0x00,0x00,0xFC,0x00,0xFC,0x80,
0x02,0xC6,0x00,0xFE,0x00,0xE6,0xF6,0xDE,0xCE,0xC6,0x00,0x00,0x38,0x18,0x38,0x00,
0x38,0x80,0x02,0x00,0x38,0x28,0x38,0x00,0x38,0x80,0x03,0x00,0x30,0x00,0x30,0x60,
0xCC,0x78,0x80,0x9F,0x00,0x7F,0xF8,0x80,0x02,0xF7,0xF8,0x7F,0x00,0xFF,0xDD,0x4D,
0x55,0x59,0xDD,0xFF,0x00,0xE0,0x80,0x04,0xF0,0xE0,0x80,0xE8,0x00,0x7F,0xE3,0x80,
0x02,0xDD,0xE3,0x7F,0x00,0xFF,0x08,0x7B,0x18,0x7B,0x7B,0xFF,0x00,0xE0,0x70,0x80,
0x03,0xF0,0xE0,0x00,0x80,0xBF,0xFF,0x80,0x3F,0x00,0x80,0xFF};


// Project: mvac7_tileset_GUI_05
// tileset color - type:G1
// RLE WB compressed - Original size= 32 - Compress size= 19
const char SC1_TSET_COLOR[]={
0x74,0x24,0xE4,0xE4,0x80,0x11,0xF4,0x04,0x34,0x80,0x02,0x04,0x94,0x80,0x02,0x48,
0x04,0x80,0xFF};





// Function Declarations -------------------------------------------------------
void SetSpritesSize(char size);

char PEEK(uint address);
void POKE(uint address, char value);

void CopyMEM(unsigned int source, unsigned int destination, unsigned int length);

//char VPEEK(uint address);

void WAIT(uint cicles);

void ShowVumeter(char channel, char value);

void SetSPRITES();

void PlaySong();
void Play_SoundEffect(char FXnumber);
void PauseSong();
void ChangeLoop();
void ShowLoop();


// constants  ------------------------------------------------------------------
const char text01[] = "Test v1.4 (11/6/2021)";
const char text02[] = "WYZ Player Lib v1.2";

//const char presskey[] = "Press a key to Play";

const char songName[2][22]={"Pentacour's Nayade 01","Pentacour's Nayade 02"};

// global variable definition --------------------------------------------------

char VALUE;

char SPRBUFFER[72];  //20*4 =72B

boolean keyB0pressStatus;
boolean keyB6pressStatus;
boolean keyB7pressStatus;

boolean _loopState;

//char _isPlay;

uint firstPATaddr;

char _songNumber;

// Functions -------------------------------------------------------------------


void my_isr0(void) __interrupt 
{
//	DI;
//	READ_VDP_STATUS;     <<---- It is not necessary as the ISR in the BIOS does.

__asm push  AF __endasm;

    
  PlayAY();

__asm  
  ;vuelca a VRAM buffer atributos sprites
  ld   HL,#_SPRBUFFER
  ld   DE,#BASE13  
  ld   BC,#20*4
  call 0x005C  
__endasm;

__asm pop   AF __endasm;     
//  EI;
}






//
void main(void)
{
  char keyPressed;
     
  uint conta = 0;

  keyB0pressStatus=false;
  keyB6pressStatus=false;
  keyB7pressStatus=false;
  
  _loopState = false;
  
  _songNumber=0;
  
  COLOR(WHITE,DARK_BLUE,LIGHT_BLUE);
          
  WIDTH(32);
  SCREEN1();    
  SetSpritesSize(1);
  
  unRLEWBtoVRAM((uint) SC1_TSET, BASE7);
  unRLEWBtoVRAM((uint) SC1_TSET_COLOR, BASE6);   
  
  LOCATE(0,0);
  PRINT(text01);
  PRINT("\n");
  PRINT(text02);
     
  
  Player_Init((unsigned int) WYZ_songs, 
              (unsigned int) WYZ_instruments, 
              (unsigned int) WYZ_FXs, 
              (unsigned int) WYZ_notes);   
        
   
  LOCATE(0,3);
  PRINT("F1 or F2 for play a song\n");
  PRINT("1 to 7 for play a FX\n"); 
  PRINT("STOP for Mute the song\n");
  PRINT("RETURN for Restore song\n");
  PRINT("SELECT for change Loop mode\n");
    
  SetSPRITES();
  
  install_isr(my_isr0);
  
  while(1)
  {
    HALT;
    
/*    
    LOCATE(0,10);
    PRINT("Channel A:");
    PrintFNumber((AYREGS[AY_ToneA+1]*0xFF)+AYREGS[AY_ToneA],32,5);
    PrintFNumber(AYREGS[AY_AmplA],32,4);
    LOCATE(0,11);
    PRINT("Channel B:");
    PrintFNumber((AYREGS[AY_ToneB+1]*0xFF)+AYREGS[AY_ToneB],32,5);
    PrintFNumber(AYREGS[AY_AmplB],32,4);
    LOCATE(0,12);
    PRINT("Channel C:");
    PrintFNumber((AYREGS[AY_ToneC+1]*0xFF)+AYREGS[AY_ToneC],32,5);
    PrintFNumber(AYREGS[AY_AmplC],32,4);
    
    LOCATE(0,13);
    PRINT("Noise :");
    PrintFNumber(AYREGS[AY_Noise],32,5);
   
    LOCATE(0,14);
    PRINT("WYZstate :");
    PrintFNumber(WYZstate,32,5);
*/
    
    
        
    ShowVumeter(0,AYREGS[AY_AmpA]);
    ShowVumeter(1,AYREGS[AY_AmpB]);
    ShowVumeter(2,AYREGS[AY_AmpC]);
    
    
    keyPressed = GetKeyMatrix(0);  
    if (keyPressed!=0xFF)  //pressure control of the keys
    {
      if(keyB0pressStatus==false)
      {
        if (!(keyPressed & Bit1)) Play_SoundEffect(0);
        if (!(keyPressed & Bit2)) Play_SoundEffect(1);
        if (!(keyPressed & Bit3)) Play_SoundEffect(2);
        if (!(keyPressed & Bit4)) Play_SoundEffect(3);
        if (!(keyPressed & Bit5)) Play_SoundEffect(4);
        if (!(keyPressed & Bit6)) Play_SoundEffect(5);
        if (!(keyPressed & Bit7)) Play_SoundEffect(6);
      }      
    }else{
      keyB0pressStatus=false;        
    }
    
    
    keyPressed = GetKeyMatrix(6);  
    if (keyPressed!=0xFF)  //pressure control of the keys
    {
      if(keyB6pressStatus==false)
      {
        if (!(keyPressed & Bit5))    //F1 Key
        {
          keyB6pressStatus=true;
          _songNumber=0;
          PlaySong(); 
        }
        if (!(keyPressed & Bit6))    //F2 Key
        {
          keyB6pressStatus=true;
          _songNumber=1;
          PlaySong(); 
        }
        /*if (!(keyPressed & Bit7))    //F3 Key
        {
          keyB6pressStatus=true;
          PlaySong(); 
        }*/          
      }      
    }else{
      keyB6pressStatus=false;        
    }
    

    keyPressed = GetKeyMatrix(7);  
    if (keyPressed!=0xFF)  //pressure control of the keys
    {
      if(keyB7pressStatus==false)
      {
        if (!(keyPressed & Bit4))    //STOP Key
        {
          keyB7pressStatus=true;
          PauseSong(); 
        }
        if (!(keyPressed & Bit6))    //SELECT Key
        {
          keyB7pressStatus=true;
          ChangeLoop(); 
        }
        if (!(keyPressed & Bit7))    //RETURN Key
        {
          keyB7pressStatus=true;
          PlaySong();
        }          
      }      
    }else{
      keyB7pressStatus=false;        
    }
    
   
    
    Player_Decode();
    
  }

/*  
  uninstall_isr();
  
  CLS();
  PRINT("END");
  WAIT(30*5);
*/  
}



void PlaySong()
{ 
  Player_InitSong(_songNumber, _loopState);
  
  LOCATE(0,10);
  
  PRINT("Song  : ");
  PrintFNumber(_songNumber+1,32,2);
  
  PRINT("\nName  : ");  //  Pentacour's Nayade 01");
  PRINT(songName[_songNumber]);
  
  PRINT("\nAuthor: aorante");
  
  PRINT("\nTempo : ");
  PrintFNumber(TEMPO,32,2);
  
  ShowLoop();
}



//
void ShowLoop()
{
  LOCATE(0,14);
  if ((WYZstate & Bit4)) PRINT("Loop  : ½¾¿");  //189+190+191  ANSI Western European (1252)
  else PRINT("Loop  : ÝÞß");                    //221+222+223
}
/*{   
  if ((WYZstate & Bit4)) ShowState(BASE5+751,true);  //751 = 23*32 + 15
  else ShowState(BASE5+751,false);
}*/



/*
void ShowState(uint vaddr, boolean state)
{
    char tile;
    if (state==true) tile=189;
    else tile=221;
    VPOKE(vaddr++,tile++);
    VPOKE(vaddr++,tile++);
    VPOKE(vaddr,tile);
}*/


void Play_SoundEffect(char FXnumber)
{
  PlayFX(FXnumber);
  keyB0pressStatus=true;
}



void PauseSong()
{
  if((WYZstate & 0b00000010)==0) Player_Resume();  //AND binario  
  else Player_Pause();  
}



void ChangeLoop()
{
  _loopState=!_loopState;
  Player_Loop(_loopState);
  //if((WYZstate & 0b00010000)==0) Player_Loop(true); 
  //else Player_Loop(false);
  ShowLoop();  
}



/* =============================================================================
 SetSpritesSize
 Description: Set size type for the sprites.
 Input:       [char] size: 0=8x8; 1=16x16
 Output:      -
============================================================================= */ 
void SetSpritesSize(char size) __naked
{
size;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   HL,#RG0SAV+1 ; --- read vdp(1) from mem
  ld   B,(HL)

  ld   A,4(ix)    
  cp   #1
  jr   NZ,size8
  
  set  1,B ; 16x16
  jr   setSize
  
size8:
  res  1,B  ; 8x8    

setSize:  
  ld   C,#0x01
  call writeVDP
  
  pop  IX
  ret
  
  
writeVDP:

  ld   IY,#RG0SAV
  ld   E,C
  ld   D,#0
  add  IY,DE
  ld   (IY),B ;save copy of vdp value in system var
  
  ld   A,B
  di
	out	 (#VDPSTATUS),A
	ld   A,C
  or   #0x80            ;add 128 to VDP reg value
  out	 (#VDPSTATUS),A
  ei
  ret

__endasm;
}






char PEEK(uint address) __naked
{
address;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
    
  ld   L,4(IX)
  ld   H,5(IX)
  ld   A,(HL)

  ld   L,A
  pop  IX
  ret
__endasm;
}



void POKE(uint address, char value) __naked
{
address;value;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
    
  ld   L,4(IX)
  ld   H,5(IX)
  ld   A,6(IX)
  ld   (HL),A

  pop  IX
  ret  
__endasm;
}



/* =============================================================================
   CopyMEM
 
   Function : Copy a block of memory to another address.
   Input    : [unsigned int] Source memory address
              [unsigned int] Destination RAM address
              [unsigned int] length 
   Output   : -
============================================================================= */
void CopyMEM(unsigned int source, unsigned int destination, unsigned int length) __naked
{
source;destination;length;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   L,4(IX)
  ld   H,5(IX) ;source memory address
  
  ld   E,6(IX)
  ld   D,7(IX) ;Destination RAM address
  
  ld   C,8(IX)
  ld   B,9(IX) ;length
  
  ldir
  
  pop  IX
  ret
__endasm;
}




/*char VPEEK(uint address) __naked
{
address;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
    
  ld   L,4(IX)
  ld   H,5(IX) 
   
  call RDVRM
  
  ld   L,A
  pop  IX
  ret
__endasm;
}*/





/* =============================================================================
   WAIT
   Generates a pause in the execution of n interruptions.
   PAL: 50=1second. ; NTSC: 60=1second.
   Input    : [unsigned int] cicles 
   Output   : -
============================================================================= */ 
void WAIT(uint cicles)
{
  uint i;
  for(i=0;i<cicles;i++) HALT;
  return;
}














/*void testPRINT()
{
  PRINT(">Test PRINT():\n");
  PRINT(testString);
  PRINT("\n\n>Test PRINT() with Escape Sequences:");
  PRINT("\n\tLine 1\n\tLine 2\n\tLine 3"); // \t Horizontal Tab
  PRINT("\r");  // Carriage Return
  PRINT(">\n");
  PRINT("\\");  // Backslash
  PRINT("\a");  // Beep
  PRINT("\n");  // Newline
  //PRINT("\f");  // Formfeed (CLS)
  //PRINT("\v");  // Place the cursor at the top of the screen
  PRINT("\'Single quotation mark\'\n");  // Single quotation mark
  PRINT("\"Double quotation mark\"\n");         // \" Double quotation mark
  PRINT("Question mark\?\n");  // Question mark
  
  LOCATE(0,22);
  PRINT(presskey);
  INKEY();
}*/




void ShowVumeter(char channel, char value) __naked
{
channel;value;
__asm

  push IX
  ld   IX,#0
  add  IX,SP
    
  ld   C,4(IX)
  ld   A,5(IX)


;C = num channel
;A = value  
;showVumeter:

  ld   (_VALUE),A
  
  SLA  C
  SLA  C
  
  ld	 B,#0
L00107:
  ld	a,c
  ld	l,a
  rla
  sbc	a, a
  ld	h,a
  add	hl,hl
  add	hl,hl
  
  ld   DE,#_SPRBUFFER
  ADD  HL,DE
  ex   DE,HL
  
  inc	 DE
  inc	 DE
  
  ld   A,(_VALUE)
  cp	 #0
  jr	 NZ,L00102
  xor  A
  ld	 (DE),A
  jr   L00105
  
L00102:                       
  ld   A,(_VALUE)
  cp   #4
  jr	 C,L00104
  ld	 A,#16
  ld	 (DE),A
  
  ld    A,(_VALUE)
  sub   #4
  ld   (_VALUE),A
  jr	 L00105
L00104:
  ld   A,(_VALUE)
  add	 a,a
  add	 a,a
  ld	(DE),A
  xor  A
  ld   (_VALUE),A
L00105:
  inc	 C
  inc	 B
  ld	 A,B
  cp   #4
  jr	C,L00107
  

  pop  IX
  ret
  
__endasm;
}



void SetSPRITES() __naked
{
__asm


  ld   HL,#SPRITE_DATA
  ld   DE,#BASE14  
  ld   BC,#32*5
  call 0x005C

  ld   DE,#_SPRBUFFER
  ld   HL,#VUMETER
  ld   BC,#64
  ldir
  
  ret
  

SPRITE_DATA:
; 0-vum0
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
; 1-vum1
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x00
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0x00
; 2-vum2
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00
.db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00
; 3-vum3
.db 0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00
.db 0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00
; 4-vum4
.db 0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x00
.db 0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00,0xFE,0xFE,0xFE,0x00



;SPRITE ATRIBUTE DATAS #########################################################
; for adjust colors, changue the last valor in line


;Y,X,SPR,COLOR
VUMETER:
.db 167,8,0,2
.db 151,8,0,2
.db 135,8,0,10
.db 119,8,0,8

.db 167,24,0,2
.db 151,24,0,2
.db 135,24,0,10             
.db 119,24,0,8 

.db 167,40,0,2
.db 151,40,0,2
.db 135,40,0,10
.db 119,40,0,8
             
.db 167,56,0,2
.db 151,56,0,2
.db 135,56,0,10
.db 119,56,0,8
;END SPRITE ATRIBUTE DATAS #####################################################
__endasm;
}



